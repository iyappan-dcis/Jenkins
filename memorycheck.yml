---
- hosts: idau
  tasks:
   - name: Checking 404's on Nginx.
     shell: zgrep '\[01\/Mar\/2020\:03\:' /var/log/nginx/* | grep 'HTTP/1.1\" 404' | awk -F '"' '{print $2}' | awk -F ' ' '{print $2}' | sort | uniq -c
     register: shell_result
     args:
       warn: false
   - debug:
       var: shell_result.stdout_lines
   - name: Checking 500's on Nginx
     shell: zgrep '\[01\/Mar\/2020\:03\:' /var/log/nginx/* | grep 'HTTP/1.1\" 500' | awk -F '"' '{print $2}' | awk -F ' ' '{print $2}' | sort | uniq -c
     register: shell_result
     args:
       warn: false
   - debug:
       var: shell_result.stdout_lines
   - name: Send the latest report
     mail:
       host: email-smtp.us-west-2.amazonaws.com
       port: 587
       username: AKIAJE3U5UNC7JZP26AQ
       password: Ah28BAq2BV9fy3YNyi7u5MxD8xU/6FvRvzjsa718YR/5
       from: Jenkins <jenkins@formsdirect.net>
       to: Iyappan Joghee <iyappan@dcis.net>
       subject: Reports Attached
       body: 'Attached is the report requested'
       attach: /tmp/*.csv
